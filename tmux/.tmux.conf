# List of plugins
set -g @plugin 'tmux-plugins/tpm'

set -g @plugin 'tmux-plugins/tmux-open'
set -g @plugin 'tmux-plugins/tmux-resurrect'
set -g @plugin 'tmux-plugins/tmux-continuum'

# Persists tmux environment across system restarts
set -g @continuum-restore 'on'
set -g @resurrect-strategy-nvim 'session'

set -g detach-on-destroy off  # don't exit from tmux when closing a session
set -g renumber-windows on    # renumber all windows when any window is closed
set -g set-titles on # allow tmux to set the terminal window title
set -g set-titles-string '#S > #T'

set -g mouse on

set -g default-terminal "tmux-256color"
set -as terminal-features ",xterm-256color:RGB"

# set -g set-clipboard on
set-window-option -g mode-keys vi
set-option -g status-keys vi

set -s escape-time 0          # Address vim mode switching delay (http://superuser.com/a/252717/65504)
set -g history-limit 50000    # Increase scrollback buffer size from 2000 to 50000 lines
set -g display-time 4000      # Increase tmux messages display duration from 750ms to 4s

bind -T copy-mode-vi WheelUpPane select-pane \; send-keys -X -N 2 scroll-up
bind -T copy-mode-vi WheelDownPane select-pane \; send-keys -X -N 2 scroll-down

set -g status-interval 3
set -g status-left-length 0
set -g status-right-length 150
set-option -g status-style bg=default
set-option -g status-right "#(ipconfig getifaddr en0)"

## Custom keymaps
set -g @tpm-clean 'u'

bind-key b select-window -l

# Go to pane 0 and zoom
bind-key t run-shell "~/.config/dotfiles/bin/tmux-toggle-nvim-pane"

# Resize panes with arrow keys
bind -r Up resize-pane -U 5
bind -r Down resize-pane -D 5
bind -r Left resize-pane -L 5
bind -r Right resize-pane -R 5

bind h select-pane -L
bind j select-pane -D
bind k select-pane -U
bind l select-pane -R

# Send C-c to all panes in current window
bind C-c set-window-option synchronize-panes on \; send-keys C-c \; set-window-option synchronize-panes off

# Re-run last command in all panes
bind C-l set-window-option synchronize-panes on \; send-keys Up Enter \; set-window-option synchronize-panes off

# Toggle Fish vi mode with Prefix+V
bind-key V run-shell "tmux new-window -d -n 'toggle_vi_mode' 'fish -c toggle_vi_mode'"

# Set new panes to open in current directory
bind '%' split-window -c "#{pane_current_path}" -h
bind '"' split-window -c "#{pane_current_path}"
bind c new-window -c "#{pane_current_path}"

# Initialize TMUX plugin manager (keep this line at the very bottom of tmux.conf)
run '~/.tmux/plugins/tpm/tpm'
