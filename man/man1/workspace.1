.TH worktree 1 "November 2024" "worktree 1.0" "User Commands"
.SH NAME
worktree \- manage git worktrees with tmux sessions
.SH SYNOPSIS
.B worktree
.B open
.RI [ path ]
.br
.B worktree
.B close
.RI [ session_name ]
.br
.B worktree
.B minimize
.RI [ session_name ]
.br
.B worktree
.B \-\-worktree
.B create
.I branch_name
.RB [ \-\-setup ]
.br
.B worktree
.B \-\-worktree
.B remove
.RI [ branch_name ]
.br
.B worktree
.B \-\-worktree
.B cleanup
.br
.B worktree
.B help
.SH DESCRIPTION
.B worktree
is a unified tool for managing tmux sessions with two modes:
.B sessionizer mode
for quick directory-based sessions, and
.B worktree mode
for full git worktree management.
.PP
In sessionizer mode (default), the tool helps you quickly open existing directories in tmux sessions. It uses fzf to find git projects (both regular repositories and worktrees) in your current directory tree.
.PP
In worktree mode (with
.BR \-\-worktree ),
the tool provides full git worktree capabilities: creating new worktrees for branches, managing their lifecycle, and automatically setting up tmux sessions with custom layouts. When creating a worktree, the tool creates a git worktree in a sibling directory, sets up a tmux session with a configurable layout, copies environment files from the parent worktree, and optionally runs setup commands.
.SH MODES
.TP
.B Sessionizer Mode (Default)
Without the
.B \-\-worktree
flag, the tool operates as a tmux session manager. The
.B open
command finds existing git projects using fzf and creates tmux sessions for them. This mode is ideal for:
.RS
.IP \(bu 2
Quick navigation between projects
.IP \(bu 2
Opening existing worktrees
.IP \(bu 2
Working with any git repository
.IP \(bu 2
Simple tmux session management
.RE
.TP
.B Worktree Mode
With the
.B \-\-worktree
flag, the tool provides full git worktree lifecycle management. Additional commands (create, remove, cleanup) become available for managing git worktrees. This mode is ideal for:
.RS
.IP \(bu 2
Feature branch development
.IP \(bu 2
Working on multiple branches simultaneously
.IP \(bu 2
Automated worktree setup with custom layouts
.IP \(bu 2
Managing worktree lifecycle (creation, cleanup)
.RE
.SH COMMANDS
.SS Common Commands (Both Modes)
.TP
.BI "open " [path]
Open an existing directory in a tmux session. If no path is provided, uses fzf to interactively select from git projects (repositories and worktrees) found up to 3 levels deep from the current directory. The tool searches for directories containing
.B .git
(both directories for regular repos and files for worktrees).
.IP
If a tmux session for the directory already exists, attaches to it. Otherwise, creates a new session named after the directory basename.
.TP
.BI "close " [session_name]
Kill the specified tmux session. If
.I session_name
is omitted and running inside tmux, uses the current session name. Otherwise, an error is returned.
.TP
.BI "minimize " [session_name]
Close all nvim/vim instances in the specified tmux session by sending
.B :qa!
to each pane running vim or nvim. If
.I session_name
is omitted and running inside tmux, uses the current session.
.TP
.B help
Display usage information and exit.
.SS Worktree Mode Commands (Require \-\-worktree)
.TP
.BI "create " branch_name " [--setup]"
Create a new git worktree for the specified branch and open a tmux session. The worktree will be created in a sibling directory named after the branch. The tool automatically:
.RS
.IP \(bu 2
Fetches latest changes from remote
.IP \(bu 2
Creates or checks out the branch
.IP \(bu 2
Sets up a tmux session with the configured layout
.IP \(bu 2
Copies .env files from the parent repository
.IP \(bu 2
Sets worktree environment variables
.RE
.IP
Use the
.B \-\-setup
flag to run the command specified in
.B worktree_INTERNAL_SETUP_CMD
after creating the worktree.
.TP
.BI "remove " [branch_name]
Remove the git worktree for the specified branch. If
.I branch_name
is omitted, uses the current branch. Protected branches (main, master, _main, _master) cannot be removed. Any processes holding files in the worktree will be terminated.
.TP
.B cleanup
Remove all worktrees that have no active tmux session and no uncommitted changes. This command automatically cleans up stale worktrees while preserving:
.RS
.IP \(bu 2
The main worktree
.IP \(bu 2
Protected branches (main, master, _main, _master)
.IP \(bu 2
Worktrees with active tmux sessions
.IP \(bu 2
Worktrees with uncommitted changes
.RE
.IP
This is a safe way to clean up completed or abandoned branches.
.SH ENVIRONMENT
.TP
.B worktree_INTERNAL_LAYOUT
Defines the tmux layout configuration for new sessions. Uses a simple format:
.IR <count><direction> , <count><direction> ,...
where
.I count
is the number of panes and
.I direction
is either
.B v
(vertical split, side-by-side) or
.B h
(horizontal split, stacked).
.IP
Each comma-separated segment creates a new window. Panes within a window are distributed evenly using tmux's tiled layout.
.IP
.B Default:
1v (single pane, single window)
.IP
.B Examples:
.RS
.IP \(bu 2
.B 2v
\- One window with 2 vertical panes (side-by-side)
.IP \(bu 2
.B 3h
\- One window with 3 horizontal panes (stacked)
.IP \(bu 2
.B 2v,3h,1v
\- Three windows: first has 2 vertical panes, second has 3 horizontal panes, third has 1 pane
.IP \(bu 2
.B 2v,2v,2h
\- Three windows with different layouts for different workflows
.RE
.TP
.B worktree_INTERNAL_SETUP_CMD
Command to run after creating a new worktree when
.B \-\-setup
is specified. Typically used for installing dependencies or running build commands.
.IP
.B Example:
export worktree_INTERNAL_SETUP_CMD="pnpm i && pnpm build"
.TP
.B worktree_*
Any environment variable prefixed with
.B worktree_
(except those starting with
.BR worktree_INTERNAL )
will be set in the tmux session with the prefix removed. For example,
.B worktree_API_KEY
becomes
.B API_KEY
in the tmux environment.
.SH FILES
.TP
.I .env
The script copies all
.B .env
files from the parent worktree to the new worktree, preserving directory structure. Existing
.B .env
files in the target worktree are never overwritten.
.SH EXAMPLES
.SS Sessionizer Mode Examples
.TP
Open a project using fzf to select from current directory:
.B worktree open
.TP
Open a specific existing directory:
.B worktree open ~/projects/myapp
.TP
Close current tmux session:
.B worktree close
.TP
Close nvim instances in current session:
.B worktree minimize
.SS Worktree Mode Examples
.TP
Create a worktree for feature branch:
.B worktree \-\-worktree create feature/user-auth
.TP
Create worktree and run setup commands:
.B worktree \-\-worktree create feature/api-refactor \-\-setup
.TP
Open existing worktree (no --worktree needed):
.B worktree open
(select from fzf)
.TP
Remove worktree for a specific branch:
.B worktree \-\-worktree remove feature/old-feature
.TP
Remove current branch's worktree:
.B worktree \-\-worktree remove
.TP
Clean up all unused worktrees:
.B worktree \-\-worktree cleanup
.SH WORKFLOW EXAMPLES
.SS Quick Project Switching (Sessionizer Mode)
.nf
.RS
# Navigate to your projects directory
cd ~/projects

# Use fzf to find and open any project
worktree open

# Work in the project...

# Close when done
worktree close
.RE
.fi
.SS Feature Development (Worktree Mode)
.nf
.RS
# Configure layout and create new worktree
export worktree_INTERNAL_LAYOUT="2v,3h"
worktree \-\-worktree create feature/new-api \-\-setup

# Work on the feature...
# (tmux session is active with your configured layout)

# Close the session (worktree remains)
worktree close

# Later, reopen the worktree using fzf
cd ~/projects
worktree open  # Select feature/new-api from fzf

# When feature is merged, clean up
worktree \-\-worktree remove feature/new-api

# Or clean up all merged worktrees at once
worktree \-\-worktree cleanup
.RE
.fi
.SH CONFIGURATION
To configure worktree behavior, set environment variables in your shell configuration file (e.g.,
.IR ~/.config/dotfiles/.env ):
.PP
.nf
.RS
# Tmux layout: 2 vertical panes in first window, 3 horizontal in second
export worktree_INTERNAL_LAYOUT="2v,3h"

# Setup command to run with create \-\-setup
export worktree_INTERNAL_SETUP_CMD="pnpm install && pnpm build"

# Custom worktree variables (available in tmux as API_URL)
export worktree_API_URL="http://localhost:3000"
.RE
.fi
.PP
.B Project Discovery:
The
.B open
command without arguments uses
.BR find (1)
to search for git projects up to 3 levels deep from the current directory. It finds both:
.RS
.IP \(bu 2
Regular git repositories (directories with
.B .git
directory)
.IP \(bu 2
Git worktrees (directories with
.B .git
file pointing to parent repository)
.RE
.PP
This allows seamless discovery of both main repositories and all their worktrees.
.SH IMPLEMENTATION DETAILS
.TP
.B Worktree Location
Worktrees are created in sibling directories to the main repository. For example, if your main repo is at
.IR /projects/myapp ,
a worktree for branch
.B feature/auth
will be created at
.IR /projects/feature/auth .
.TP
.B Protected Branches
The branches
.BR main ", " master ", " _main ", and " _master
are protected and cannot be removed using
.BR \-\-remove .
.TP
.B Process Cleanup
When removing a worktree, any processes holding files in that directory are automatically terminated using
.BR lsof (1)
or
.BR ps (1).
.SH EXIT STATUS
.TP
.B 0
Success
.TP
.B 1
Error (missing branch name, protected branch removal, worktree not found, etc.)
.SH SEE ALSO
.BR git-worktree (1),
.BR tmux (1),
.BR fish (1)
.SH AUTHOR
Written for dotfiles configuration management.
.SH BUGS
Report bugs at: https://github.com/anthropics/claude-code/issues
